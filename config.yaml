# ActiveTrader-LLM Configuration
# Cost-efficient, reasoning-based LLM agent for active stock trading

mode: paper-live  # backtest | paper-live

# Data sources
data_sources:
  prices: yfinance
  interval: 1d  # 1h, 1d, 5m, 15m (using 1d for backtest compatibility)
  universe:  # Fallback universe if scanner fails
    - AAPL
    - MSFT
    - SPY
    - QQQ
  lookback_days: 90

# Technical Indicators Configuration
technical_indicators:
  # Data quality requirements
  quality:
    min_bars_required: 20         # Reduced for backtest compatibility (was 250)
    reject_incomplete: false       # Allow symbols with some missing indicators for backtest

  # Daily timeframe indicators
  daily:
    ema_5:
      enabled: true
      period: 5
    ema_10:
      enabled: true
      period: 10
    ema_20:
      enabled: true
      period: 20
    sma_50:
      enabled: true       # Enabled for LLM decision making
      period: 50
    sma_200:
      enabled: true       # Enabled for LLM decision making
      period: 200
    rsi:
      enabled: true
      period: 14
    atr:
      enabled: true
      period: 14

  # Weekly timeframe indicators (converted from daily data)
  weekly:
    ema_10:
      enabled: true           # Enabled for LLM decision making - 10 week EMA
      period: 10              # 10 weeks
      conversion: 50          # 10 weeks * 5 trading days
    sma_21:
      enabled: true           # Enabled for LLM decision making - 21 week SMA
      period: 21              # 21 weeks
      conversion: 105         # 21 weeks * 5 trading days
    sma_30:
      enabled: true           # Enabled for LLM decision making - 30 week SMA
      period: 30              # 30 weeks
      conversion: 150         # 30 weeks * 5 trading days
    sma_50:
      enabled: false          # Not needed for LLM (requires 250 days)
      period: 50              # 50 weeks
      conversion: 250         # 50 weeks * 5 trading days

# Market Breadth Configuration
# Returns RAW market data only (no regime classification)
# LLM interprets the raw breadth counts to determine market environment
market_breadth:
  enabled: true

  new_highs_lows:
    lookback_days: 252            # ~1 year
    min_data_bars: 20
    high_threshold_pct: 0.98      # Within 2% of high
    low_threshold_pct: 1.02       # Within 2% of low

  # regime_thresholds removed - LLM decides market regime from raw data

# Two-stage market scanner
scanner:
  enabled: false  # Set to true to use scanner mode instead of fixed universe
  universe_source: alpaca_optionable  # alpaca_optionable | tradable_universe_cache | custom
  alpaca_api_url: ${ALPACA_BASE_URL}  # Use environment variable
  refresh_universe_hours: 24  # How often to refresh universe cache
  stage1:
    enabled: true
    target_candidate_count: 50  # Target number of candidates for Stage 2 (reduced for live trading)
    market_summary_sectors: 11  # Number of sectors to include in market summary
  stage2:
    batch_size: 15  # Stocks per LLM call in deep analysis
    max_batches: 3  # Max batches to process (reduced for live trading cost control)
    max_candidates: 50  # Max candidates to analyze in Stage 2 (reduced for live trading)

# Risk parameters
# IMPORTANT: Position sizing limits removed - agent decides based on performance
risk_parameters:
  # Emergency safety rail (optional)
  enforce_daily_drawdown: true       # Enable emergency circuit breaker
  emergency_drawdown_limit: 0.20     # 20% daily loss triggers halt

  # Strategy performance thresholds (for strategy switching, not trade approval)
  min_win_rate: 0.35
  min_net_pl: 0.0

# Trade Plan Validation
# Validates LLM-generated trade plans to prevent impossible or dangerous parameters
trade_validation:
  enabled: true                      # Enable trade plan validation
  max_position_pct: 10.0             # Maximum position size as % of capital
  min_risk_reward_ratio: 1.5         # Minimum R:R ratio (reward/risk)
  max_price_deviation_pct: 5.0       # Max deviation from current price (prevents stale prices)
  min_stop_distance_pct: 0.5         # Minimum stop distance from entry (prevents noise stops)
  max_stop_distance_pct: 15.0        # Maximum stop distance from entry (prevents excessive risk)

# Position Management
# Tracks positions across decision cycles and manages exits
position_management:
  enabled: true
  max_total_exposure_pct: 80.0        # Maximum total portfolio exposure
  allow_duplicate_symbols: false      # Prevent multiple positions in same symbol
  auto_close_eod: true               # Close all positions before market close
  eod_close_time: "15:55"            # Time to close positions (3:55 PM)

# Execution Schedule
# When to run decision cycles
execution_schedule:
  times:
    - "09:30"  # Market open
    - "12:00"  # Midday
    - "16:00"  # Market close (for final checks)
  timezone: "America/New_York"
  monitor_exits_interval_seconds: 60  # How often to check exits between cycles

# Trading strategies - REMOVED: LLM decides dynamically
# strategies:
#   - name: momentum_breakout
#     regime: trending_bull
#     enabled: true
#   - name: mean_reversion
#     regime: range
#     enabled: true
#   - name: pullback
#     regime: mild_trend
#     enabled: true
#   - name: sector_rotation
#     regime: mixed
#     enabled: true

# Strategy switching - REMOVED: No predefined strategies
# strategy_switching:
#   window_trades: 30  # Evaluate last 30 trades
#   min_win_rate: 0.35
#   min_net_pl: 0.0
#   hysteresis_trades_before_switch: 10  # Cooldown period

# Scheduling
schedule:
  decision_interval: 1h  # How often to make decisions
  learning_update: daily  # How often to update strategy stats

# Cost controls
cost_control:
  combine_symbols_per_prompt: true
  cache_data: true
  minimize_call_frequency: true
  max_cost_per_decision_usd: 0.05

# LLM configuration
llm:
  provider: openai  # anthropic | openai | local
  model: gpt-3.5-turbo  # gpt-4o, gpt-4-turbo, gpt-3.5-turbo
  api_key: ${OPENAI_API_KEY}  # Use environment variable
  temperature: 0.3
  max_tokens: 2000

# Storage paths
database_path: data/trading.db
log_path: logs/trade_log.jsonl

# Backtest-specific settings
backtest:
  # Execution cost modeling
  execution_costs:
    commission_per_share: 0.005        # Commission per share (e.g., $0.005)
    min_commission: 1.0                # Minimum commission per trade
    max_commission_pct: 0.5            # Max commission as % of trade value
    base_slippage_bps: 2.0             # Base slippage in basis points
    volume_impact_factor: 0.1          # Impact of trade size relative to volume
    max_position_pct_of_adv: 5.0       # Max position as % of avg daily volume
    allow_premarket: false             # Allow pre-market trading
    allow_afterhours: false            # Allow after-hours trading

# Execution configuration (for paper-live/live modes)
execution:
  broker: alpaca                       # alpaca | simulated
  paper_trading: true                  # Use paper trading account
  order_type: market                   # market | limit
  time_in_force: day                   # day | gtc | ioc
  commission_per_trade: 1.0            # Fixed commission per trade (USD)
  slippage_bps: 5.0                    # Slippage in basis points (5 bps = 0.05%)
  alpaca_api_key_env: ALPACA_API_KEY   # Environment variable for API key
  alpaca_secret_key_env: ALPACA_SECRET_KEY  # Environment variable for secret key
  alpaca_base_url: https://paper-api.alpaca.markets  # Alpaca API URL

# Macro Analysis Settings
macro_data:
  cache_duration_seconds: 300  # Cache macro data for 5 minutes
  use_yfinance: true           # Use yfinance for macro data fetching

# Feature flags
enable_sentiment: false  # Enable sentiment analysis (requires additional setup)
enable_macro: false      # Enable macro analysis (set to true to enable)
