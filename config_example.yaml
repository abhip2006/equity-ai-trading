# ActiveTrader-LLM Configuration Example
# ==========================================
# This file demonstrates all configurable parameters

mode: backtest  # backtest | paper-live

# ==========================================
# TECHNICAL INDICATORS
# ==========================================
# Customize indicator periods for different trading styles:
#   - Day trading: RSI(14), MACD(12/26/9), EMA(50/200)  ← Current defaults
#   - Scalping: RSI(7), MACD(5/13/5), EMA(20/50)
#   - Swing trading: RSI(21), MACD(24/52/9), EMA(100/200)

indicators:
  rsi_period: 14
  macd_fast: 12
  macd_slow: 26
  macd_signal: 9
  bollinger_period: 20
  bollinger_std: 2.0
  atr_period: 14
  ema_short: 50
  ema_long: 200
  sma_period: 20

# ==========================================
# REGIME CLASSIFICATION THRESHOLDS
# ==========================================
# Adjust for different market environments:
#   - Bull market: Raise thresholds (trending_bull_breadth: 0.7)
#   - Bear market: Lower thresholds (risk_off_breadth: -0.4)
#   - Choppy market: Wider range zone (-0.2 to 0.2)

regime_thresholds:
  risk_off_breadth: -0.5        # Breadth score below this triggers risk_off
  risk_off_rsi: 35.0            # Average RSI below this also triggers risk_off
  trending_bull_breadth: 0.5    # Breadth above this suggests trending_bull
  trending_bull_pct_above_ema200: 0.6  # % of stocks above 200-day EMA for trending_bull
  trending_bear_breadth: -0.3   # Breadth below this suggests trending_bear

# ==========================================
# MACRO ANALYST THRESHOLDS
# ==========================================
# VIX interpretation varies by market environment:
#   - 2019 (low vol): vix_risk_off: 20, vix_risk_on: 10
#   - 2020 (COVID): vix_risk_off: 40, vix_risk_on: 15
#   - 2024 (normal): vix_risk_off: 25, vix_risk_on: 12  ← Current defaults

macro_thresholds:
  vix_risk_off: 25.0  # VIX above this = risk-off bias
  vix_risk_on: 12.0   # VIX below this = risk-on bias

# ==========================================
# MARKET SCANNER (Dynamic Universe Discovery)
# ==========================================
# The scanner automatically finds liquid, tradable stocks that meet your criteria.
# When enabled, it overrides the static universe in data_sources.
#
# Base Universe Options:
#   - sp500: Scan S&P 500 constituents (~500 large caps)
#   - nasdaq100: Scan NASDAQ-100 constituents (~100 tech-focused)
#   - sp400: S&P MidCap 400 (not yet implemented)
#   - sp600: S&P SmallCap 600 (not yet implemented)
#   - custom: Use custom_tickers list
#
# Scanner Profiles:
#   - Day Trading: min_avg_volume: 2M, min_dollar_volume: 20M, min_atr_pct: 0.015 (1.5%)
#   - Swing Trading: min_avg_volume: 1M, min_dollar_volume: 10M, min_atr_pct: None  ← Current
#   - Blue Chip Only: min_market_cap: 10B, max_universe_size: 20
#   - High Volatility: min_atr_pct: 0.03, max_atr_pct: 0.15

scanner:
  enabled: true                      # Enable dynamic scanning (if false, uses data_sources.universe)

  # Base universe
  base_universe: sp500               # sp500 | nasdaq100 | sp400 | sp600 | custom
  custom_tickers: []                 # Only used if base_universe = custom

  # Volume filters (liquidity requirements)
  min_avg_volume: 1000000           # Min 1M shares/day average (20-day)
  min_dollar_volume: 10000000       # Min $10M/day traded ($10M = 1M shares × $10)

  # Price filters (avoid penny stocks and extremely expensive stocks)
  min_price: 5.0                    # Min $5 per share
  max_price: 1000.0                 # Max $1000 per share

  # Market cap filter (optional, null = disabled)
  min_market_cap: null              # e.g., 1000000000 for $1B+ market cap

  # Volatility filters (optional, null = disabled)
  min_atr_pct: null                 # e.g., 0.02 for 2%+ daily ATR (for day trading)
  max_atr_pct: null                 # e.g., 0.10 for <10% daily ATR (avoid extreme volatility)

  # Universe size limits (cost control)
  max_universe_size: 50             # Max 50 symbols to analyze (controls LLM costs)

  # Scan frequency
  scan_interval_hours: 24           # Re-scan every 24 hours (daily)

  # Cache settings (speeds up repeated scans)
  use_cache: true                   # Cache scan results
  cache_expiry_hours: 24            # Cache expires after 24 hours

# ==========================================
# DATA SOURCES
# ==========================================
# Note: If scanner.enabled = true, the universe list below is IGNORED
# and the scanner dynamically populates the universe instead.

data_sources:
  prices: yfinance
  interval: 1h  # 1m, 5m, 15m, 1h, 1d
  universe:                         # Only used if scanner.enabled = false
    - AAPL
    - MSFT
    - GOOGL
    - AMZN
    - NVDA
    - TSLA
    - SPY
    - QQQ
  lookback_days: 90  # Days of historical data to fetch

# ==========================================
# RISK MANAGEMENT
# ==========================================
# Risk profiles for different trader types:
#   - Conservative: max_position_pct: 0.02 (2%), max_daily_drawdown: 0.05 (5%)
#   - Moderate: max_position_pct: 0.05 (5%), max_daily_drawdown: 0.10 (10%)  ← Current defaults
#   - Aggressive: max_position_pct: 0.10 (10%), max_daily_drawdown: 0.15 (15%)

risk_parameters:
  max_position_pct: 0.05           # Max 5% of portfolio per position
  max_concurrent_positions: 8       # Max number of open positions
  max_daily_drawdown: 0.10         # Stop trading if lose 10% in a day
  max_sector_concentration: 0.30    # Max 30% of portfolio in one sector
  min_win_rate: 0.35               # Min 35% win rate to continue strategy
  min_net_pl: 0.0                  # Min $0 P/L threshold

# ==========================================
# STRATEGIES
# ==========================================

strategies:
  - name: momentum_breakout
    regime: trending_bull
    enabled: true

  - name: mean_reversion
    regime: range
    enabled: true

  - name: pullback
    regime: mild_trend
    enabled: true

  - name: sector_rotation
    regime: mixed
    enabled: true

# ==========================================
# STRATEGY SWITCHING
# ==========================================
# Switching sensitivity:
#   - Conservative: window: 50, min_win_rate: 0.40, hysteresis: 20  (slower to switch)
#   - Moderate: window: 30, min_win_rate: 0.35, hysteresis: 10  ← Current defaults
#   - Aggressive: window: 15, min_win_rate: 0.30, hysteresis: 5  (quick to switch)

strategy_switching:
  window_trades: 30                 # Evaluate last 30 trades
  min_win_rate: 0.35               # Min 35% win rate to keep strategy
  min_net_pl: 0.0                  # Min $0 P/L to keep strategy
  hysteresis_trades_before_switch: 10  # Wait 10 trades before switching back

  # Strategy selection scoring weights
  # Formula: score = (win_rate * win_rate_weight) + (min(avg_return, cap) * avg_return_weight) + (avg_rr * avg_rr_weight)
  #
  # Different priority profiles:
  #   - Win rate priority: win_rate_weight: 50, avg_return_weight: 0.5, avg_rr_weight: 10  ← Current
  #   - Return priority: win_rate_weight: 20, avg_return_weight: 2.0, avg_rr_weight: 15
  #   - R:R priority: win_rate_weight: 30, avg_return_weight: 0.5, avg_rr_weight: 25

  win_rate_weight: 50.0      # Weight for win rate in scoring
  avg_return_weight: 0.5     # Weight for average return in scoring
  avg_return_cap: 100.0      # Cap returns at this value for scoring
  avg_rr_weight: 10.0        # Weight for average risk/reward ratio

# ==========================================
# SCHEDULE
# ==========================================

schedule:
  decision_interval: 1h  # How often to make trading decisions
  learning_update: daily  # How often to update strategy performance

# ==========================================
# COST CONTROL
# ==========================================

cost_control:
  combine_symbols_per_prompt: true   # Batch symbols to reduce API calls
  cache_data: true                   # Cache market data
  minimize_call_frequency: true      # Reduce LLM call frequency
  max_cost_per_decision_usd: 0.05   # Max spend per decision cycle

# ==========================================
# LLM CONFIGURATION
# ==========================================

llm:
  provider: anthropic  # anthropic | openai | local
  model: claude-3-5-sonnet-20241022
  api_key:  # Set via environment variable ANTHROPIC_API_KEY
  temperature: 0.3
  max_tokens: 2000

# ==========================================
# STORAGE
# ==========================================

database_path: data/trading.db
log_path: logs/trade_log.jsonl

# ==========================================
# FEATURE FLAGS
# ==========================================

enable_sentiment: false  # Enable sentiment analyst (requires NewsAPI/FinBERT)
enable_macro: true       # Enable macro analyst (requires VIX data from yfinance)
